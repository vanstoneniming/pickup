# 后端服务启动说明

## 错误信息

如果前端出现以下错误：
```
Error: connect ECONNREFUSED ::1:3000
```

说明后端服务没有运行。

## 启动步骤

### 1. 检查依赖是否安装

```bash
cd backend
ls node_modules
```

如果没有 `node_modules` 目录，需要安装依赖：

```bash
npm install
# 或
pnpm install
```

### 2. 检查配置文件

确保 `.env` 文件存在并配置正确：

```bash
cp .env.example .env
# 然后编辑 .env 文件，配置数据库连接信息
```

### 3. 检查数据库是否创建

```bash
# 如果数据库未创建，先执行初始化
./init-database.sh
```

### 4. 启动后端服务

```bash
# 开发环境（自动重启）
npm run dev

# 或生产环境
npm start
```

### 5. 验证服务运行

看到以下信息说明启动成功：
```
数据库连接成功
服务器运行在 http://localhost:3000
```

## 常见问题

### 问题 1: 数据库连接失败

**错误信息**：
```
Error: connect ECONNREFUSED 127.0.0.1:3306
```

**解决方法**：
1. 检查 MySQL 服务是否运行：
   ```bash
   brew services list | grep mysql
   ```

2. 如果未运行，启动 MySQL：
   ```bash
   brew services start mysql
   ```

3. 检查 `.env` 文件中的数据库配置是否正确

### 问题 2: 端口被占用

**错误信息**：
```
Error: listen EADDRINUSE: address already in use :::3000
```

**解决方法**：
1. 查找占用端口的进程：
   ```bash
   lsof -ti:3000
   ```

2. 杀掉进程：
   ```bash
   kill -9 $(lsof -ti:3000)
   ```

3. 或修改 `.env` 文件中的 `PORT` 配置

### 问题 3: 模块未找到

**错误信息**：
```
Cannot find module 'xxx'
```

**解决方法**：
```bash
npm install
```

### 问题 4: 数据库表不存在

**错误信息**：
```
Table 'pickup_db.users' doesn't exist
```

**解决方法**：
```bash
./init-database.sh
```

## 快速启动命令

```bash
# 1. 进入后端目录
cd backend

# 2. 安装依赖（如果未安装）
npm install

# 3. 启动服务
npm run dev
```

## 验证服务

启动成功后，可以测试 API：

```bash
# 健康检查
curl http://localhost:3000/health

# 应该返回：
# {"status":"ok","message":"服务运行正常"}
```

