# 数据库初始化说明

## 方法一：使用自动化脚本（推荐）

### 步骤 1：进入后端目录

```bash
cd backend
```

### 步骤 2：运行初始化脚本

```bash
./init-database.sh
```

脚本会提示你输入 MySQL root 密码，然后自动：
- 创建数据库 `pickup_db`
- 创建所有数据表
- 创建数据库用户 `pickup_db` 并授权

## 方法二：手动执行 SQL 脚本

### 步骤 1：使用 root 用户登录 MySQL

```bash
mysql -u root -p
```

输入 root 密码。

### 步骤 2：执行初始化脚本

在 MySQL 命令行中执行：

```bash
source /Users/niming/pickup/backend/init-database.sql
```

或者直接执行：

```bash
mysql -u root -p < init-database.sql
```

## 方法三：分步执行（如果遇到问题）

### 1. 创建数据库

```sql
CREATE DATABASE IF NOT EXISTS pickup_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 2. 创建用户并授权

```sql
CREATE USER IF NOT EXISTS 'pickup_db'@'localhost' IDENTIFIED BY 'pickup_db';
GRANT ALL PRIVILEGES ON pickup_db.* TO 'pickup_db'@'localhost';
FLUSH PRIVILEGES;
```

### 3. 创建表

执行 `init-database.sql` 文件中的表创建语句。

## 验证数据库创建成功

```bash
# 使用新创建的用户登录
mysql -u pickup_db -ppickup_db pickup_db

# 查看表
SHOW TABLES;

# 应该看到以下表：
# - users
# - crab_cards
# - deliveries
# - sms_codes
```

## 配置 .env 文件

确保 `backend/.env` 文件中的数据库配置正确：

```env
DB_HOST=localhost
DB_PORT=3306
DB_NAME=pickup_db
DB_USER=pickup_db
DB_PASSWORD=pickup_db
```

## 常见问题

### 1. 提示权限不足

确保使用 root 用户执行初始化脚本。

### 2. 用户已存在

如果用户已存在，可以跳过用户创建步骤，或者先删除：

```sql
DROP USER IF EXISTS 'pickup_db'@'localhost';
```

### 3. 数据库已存在

如果数据库已存在，脚本会跳过创建（使用 `IF NOT EXISTS`）。

### 4. 忘记 root 密码

参考 `docs/MySQL密码重置指南.md` 重置密码。

## 测试数据库连接

创建完成后，可以测试后端是否能连接数据库：

```bash
cd backend
npm run dev
```

如果看到 "数据库连接成功" 的日志，说明配置正确。

