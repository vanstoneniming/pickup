# 修复数据库连接问题

## 问题描述

错误信息：`connect ECONNREFUSED ::1:3306`

原因：
1. MySQL 服务未运行
2. `localhost` 在某些系统上解析为 IPv6 (`::1`)，但 MySQL 可能只监听 IPv4

## 解决方案

### 步骤 1：启动 MySQL 服务

```bash
brew services start mysql
```

验证服务是否运行：
```bash
brew services list | grep mysql
```

应该看到 `started` 状态。

### 步骤 2：修改数据库配置

已修改 `src/config/database.js`，自动将 `localhost` 转换为 `127.0.0.1`。

或者手动修改 `.env` 文件：

```env
DB_HOST=127.0.0.1
```

而不是：
```env
DB_HOST=localhost
```

### 步骤 3：重启后端服务

```bash
# 如果服务正在运行，按 Ctrl+C 停止
# 然后重新启动
pnpm run dev
```

## 验证连接

启动后端后，应该看到：
```
数据库连接成功
服务器运行在 http://localhost:3000
```

如果没有看到，检查：
1. MySQL 服务是否运行
2. `.env` 文件中的数据库配置是否正确
3. 数据库用户和密码是否正确

## 快速修复命令

```bash
# 1. 启动 MySQL
brew services start mysql

# 2. 修改 .env 文件（如果使用 localhost）
cd backend
sed -i '' 's/DB_HOST=localhost/DB_HOST=127.0.0.1/' .env

# 3. 重启后端服务
pnpm run dev
```

