# 短信验证码调试说明

## 开发模式

在开发环境下，可以跳过真实短信发送，验证码会在后端控制台输出，方便调试。

### 配置方式

在 `backend/.env` 文件中设置：

```env
# 开发模式：跳过真实短信发送
SKIP_SMS=true

# 或者依赖 NODE_ENV（development 模式自动跳过）
NODE_ENV=development
```

### 开发模式行为

1. **跳过频率限制**：不会检查1分钟内是否已发送
2. **跳过真实短信**：不会调用阿里云短信接口
3. **控制台输出**：验证码会在后端控制台输出，格式如下：
   ```
   [开发模式] 验证码已生成: 123456 (手机号: 13800138000)
   ```
4. **保存到数据库**：验证码仍会保存到数据库，可以正常验证

## 清理验证码记录

如果测试时验证码记录过多，可以清理：

```bash
# 方法一：使用 SQL 脚本
mysql -u pickup_db -ppickup_db pickup_db < 清理验证码.sql

# 方法二：手动执行 SQL
mysql -u pickup_db -ppickup_db pickup_db
```

```sql
-- 删除所有已使用的验证码
DELETE FROM sms_codes WHERE used = 1;

-- 删除所有过期的验证码
DELETE FROM sms_codes WHERE expires_at < NOW();

-- 删除所有验证码（谨慎使用）
DELETE FROM sms_codes;
```

## 生产环境

生产环境下：
- 设置 `NODE_ENV=production`
- 不设置或设置 `SKIP_SMS=false`
- 配置正确的阿里云短信参数
- 会进行频率限制（1分钟内不能重复发送）
- 会调用真实的阿里云短信接口

## 测试流程

1. **启动后端服务**
   ```bash
   cd backend
   npm run dev
   ```

2. **发送验证码**
   - 前端点击"发送验证码"按钮
   - 在后端控制台查看输出的验证码

3. **输入验证码**
   - 使用控制台输出的验证码进行验证

4. **清理测试数据**（如需要）
   ```bash
   mysql -u pickup_db -ppickup_db pickup_db < 清理验证码.sql
   ```

## 常见问题

### Q: 为什么提示"发送过于频繁"？

A: 在非开发模式下，1分钟内不能重复发送。解决方案：
- 等待1分钟后重试
- 或开启开发模式（设置 `SKIP_SMS=true`）
- 或清理该手机号的验证码记录

### Q: 如何查看已生成的验证码？

A: 在开发模式下，验证码会输出到后端控制台。也可以查询数据库：
```sql
SELECT phone, code, used, expires_at, created_at 
FROM sms_codes 
ORDER BY created_at DESC 
LIMIT 10;
```

### Q: 验证码有效期是多久？

A: 默认10分钟。可以在代码中修改 `expiresAt` 的值。

