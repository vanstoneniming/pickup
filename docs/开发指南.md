# 开发指南

## 一、开发环境搭建

### 1.1 安装依赖

**前端依赖安装**：
```bash
cd frontend
npm install
```

**后端依赖安装**：
```bash
cd backend
npm install
```

### 1.2 数据库配置

1. 创建 MySQL 数据库：
```sql
CREATE DATABASE pickup_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

2. 执行数据库初始化脚本（参考 `数据库设计.md`）

3. 配置后端环境变量（`backend/.env`）：
```env
DB_HOST=localhost
DB_PORT=3306
DB_NAME=pickup_db
DB_USER=root
DB_PASSWORD=your_password
JWT_SECRET=your-secret-key
```

### 1.3 启动开发服务器

**启动后端**：
```bash
cd backend
npm run dev
```

**启动前端**：
```bash
cd frontend
npm run dev
```

## 二、代码规范

### 2.1 命名规范

- **文件命名**：使用小写字母和连字符，如 `user-profile.vue`
- **组件命名**：使用 PascalCase，如 `UserProfile`
- **变量命名**：使用 camelCase，如 `userName`
- **常量命名**：使用 UPPER_SNAKE_CASE，如 `MAX_COUNT`

### 2.2 代码风格

- 使用 ESLint 和 Prettier 进行代码格式化
- 缩进使用 2 个空格
- 字符串使用单引号
- 行尾不使用分号（根据项目配置）

### 2.3 注释规范

- 使用中文注释
- 函数和类使用 JSDoc 格式注释
- 复杂逻辑添加行内注释说明

示例：
```javascript
/**
 * 创建订单
 * @param {Object} orderData - 订单数据
 * @param {number} orderData.userId - 用户ID
 * @param {Array} orderData.items - 订单商品列表
 * @returns {Promise<Object>} 创建的订单对象
 */
async function createOrder(orderData) {
  // 验证订单数据
  // ...
}
```

## 三、前端开发规范

### 3.1 组件开发

1. **使用 Composition API**
   ```vue
   <script setup>
   import { ref, computed } from 'vue'
   
   const count = ref(0)
   const doubleCount = computed(() => count.value * 2)
   </script>
   ```

2. **Props 定义**
   ```vue
   <script setup>
   const props = defineProps({
     title: {
       type: String,
       required: true
     },
     count: {
       type: Number,
       default: 0
     }
   })
   </script>
   ```

3. **事件定义**
   ```vue
   <script setup>
   const emit = defineEmits(['update', 'delete'])
   
   const handleClick = () => {
     emit('update', data)
   }
   </script>
   ```

### 3.2 API 调用

1. **创建 API 文件**
   ```javascript
   // frontend/src/api/orders.js
   import request from '@/utils/request'
   
   export function getOrders(params) {
     return request({
       url: '/api/v1/orders',
       method: 'get',
       params
     })
   }
   ```

2. **在组件中使用**
   ```vue
   <script setup>
   import { ref, onMounted } from 'vue'
   import { getOrders } from '@/api/orders'
   
   const orders = ref([])
   
   const fetchOrders = async () => {
     const response = await getOrders({ page: 1 })
     orders.value = response.data.list
   }
   
   onMounted(() => {
     fetchOrders()
   })
   </script>
   ```

### 3.3 状态管理

使用 Pinia 进行状态管理：

```javascript
// frontend/src/stores/orders.js
import { defineStore } from 'pinia'
import { ref } from 'vue'
import { getOrders } from '@/api/orders'

export const useOrderStore = defineStore('orders', () => {
  const orders = ref([])
  const loading = ref(false)
  
  async function fetchOrders(params) {
    loading.value = true
    try {
      const response = await getOrders(params)
      orders.value = response.data.list
    } finally {
      loading.value = false
    }
  }
  
  return {
    orders,
    loading,
    fetchOrders
  }
})
```

## 四、后端开发规范

### 4.1 路由定义

```javascript
// backend/src/routes/orders.js
import express from 'express'
import { authenticate } from '../middleware/auth.js'
import OrderController from '../controllers/OrderController.js'

const router = express.Router()

router.get('/', authenticate, OrderController.list)
router.post('/', authenticate, OrderController.create)
router.get('/:id', authenticate, OrderController.detail)

export default router
```

### 4.2 控制器开发

```javascript
// backend/src/controllers/OrderController.js
import Order from '../models/Order.js'

class OrderController {
  async list(req, res) {
    try {
      const orders = await Order.findAll()
      res.json({
        code: 200,
        message: 'success',
        data: orders
      })
    } catch (error) {
      res.status(500).json({
        code: 500,
        message: '查询失败',
        data: null
      })
    }
  }
}

export default new OrderController()
```

### 4.3 数据验证

使用 express-validator 进行数据验证：

```javascript
import { body, validationResult } from 'express-validator'

router.post('/', [
  body('name').notEmpty().withMessage('名称不能为空'),
  body('email').isEmail().withMessage('邮箱格式不正确')
], async (req, res) => {
  const errors = validationResult(req)
  if (!errors.isEmpty()) {
    return res.status(400).json({
      code: 400,
      message: errors.array()[0].msg,
      data: null
    })
  }
  // ...
})
```

### 4.4 错误处理

统一错误处理格式：

```javascript
try {
  // 业务逻辑
} catch (error) {
  console.error('操作错误:', error)
  res.status(500).json({
    code: 500,
    message: '操作失败',
    data: null
  })
}
```

## 五、数据库操作

### 5.1 模型定义

```javascript
// backend/src/models/Product.js
import { DataTypes } from 'sequelize'
import { sequelize } from '../config/database.js'

const Product = sequelize.define('Product', {
  name: {
    type: DataTypes.STRING(100),
    allowNull: false,
    comment: '商品名称'
  },
  price: {
    type: DataTypes.DECIMAL(10, 2),
    allowNull: false,
    comment: '价格'
  }
}, {
  tableName: 'products',
  timestamps: true
})

export default Product
```

### 5.2 查询操作

```javascript
// 查询所有
const products = await Product.findAll()

// 条件查询
const product = await Product.findOne({
  where: { id: 1 }
})

// 分页查询
const { count, rows } = await Product.findAndCountAll({
  limit: 20,
  offset: 0
})

// 关联查询
const order = await Order.findByPk(1, {
  include: [
    { model: OrderItem, as: 'items' }
  ]
})
```

## 六、测试

### 6.1 单元测试

使用 Jest 进行单元测试（待实现）

### 6.2 API 测试

使用 Postman 或类似工具测试 API 接口

## 七、常见问题

### 7.1 跨域问题

后端已配置 CORS，如仍有问题，检查：
- 前端请求的 baseURL 是否正确
- 后端 CORS 配置是否正确

### 7.2 数据库连接失败

检查：
- 数据库服务是否启动
- 数据库连接配置是否正确
- 数据库用户权限是否足够

### 7.3 Token 过期

Token 过期后需要重新登录，前端会自动跳转到登录页

## 八、最佳实践

1. **代码复用**
   - 提取公共组件和工具函数
   - 避免重复代码

2. **错误处理**
   - 统一错误处理格式
   - 记录错误日志

3. **性能优化**
   - 使用分页查询
   - 合理使用索引
   - 避免 N+1 查询问题

4. **安全性**
   - 验证用户输入
   - 使用参数化查询
   - 敏感信息加密存储

5. **代码提交**
   - 提交前运行 lint 检查
   - 编写清晰的提交信息
   - 小步提交，频繁提交

