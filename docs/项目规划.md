# 蟹卡提货管理系统 - 项目规划文档

## 一、项目概述

### 1.1 项目背景
蟹卡提货管理系统是一个用于管理蟹卡销售、提货申请、订单处理、库存管理等全流程的综合性管理系统。

### 1.2 核心功能
- **蟹卡管理**：蟹卡的创建、查询、验证、激活、作废
- **提货管理**：提货申请、审核、发货、物流跟踪
- **用户管理**：管理员、客户账户管理
- **订单管理**：订单创建、查询、统计
- **库存管理**：蟹卡库存、实际商品库存管理
- **统计报表**：销售统计、提货统计、数据分析

## 二、功能模块详细设计

### 2.1 蟹卡管理模块

#### 2.1.1 蟹卡创建
- 批量生成蟹卡（支持自定义数量、面额、有效期）
- 蟹卡编号规则（唯一标识）
- 二维码生成（用于快速验证）
- 蟹卡状态：未激活、已激活、已使用、已作废

#### 2.1.2 蟹卡查询
- 按编号查询
- 按状态筛选
- 按创建时间范围查询
- 按客户查询

#### 2.1.3 蟹卡验证
- 扫码验证（二维码）
- 手动输入验证
- 验证结果反馈（有效/无效/已使用/已过期）

#### 2.1.4 蟹卡激活
- 客户激活（绑定客户信息）
- 管理员激活
- 激活记录查询

### 2.2 提货管理模块

#### 2.2.1 提货申请
- 客户提交提货申请（使用蟹卡）
- 选择提货商品（规格、数量）
- 填写收货信息（地址、联系人、电话）
- 选择配送方式

#### 2.2.2 提货审核
- 管理员审核提货申请
- 审核状态：待审核、已通过、已拒绝
- 审核意见记录

#### 2.2.3 发货管理
- 订单发货（填写物流信息）
- 物流单号录入
- 发货状态更新

#### 2.2.4 物流跟踪
- 物流信息查询
- 配送状态更新
- 签收确认

### 2.3 用户管理模块

#### 2.3.1 管理员管理
- 管理员账户创建
- 角色权限管理（超级管理员、普通管理员）
- 操作日志记录

#### 2.3.2 客户管理
- 客户注册/登录
- 客户信息管理
- 客户提货历史查询

### 2.4 订单管理模块

#### 2.4.1 订单创建
- 自动生成订单号
- 订单详情记录
- 订单状态管理

#### 2.4.2 订单查询
- 按订单号查询
- 按客户查询
- 按状态筛选
- 按时间范围查询

#### 2.4.3 订单统计
- 订单数量统计
- 销售额统计
- 订单状态分布

### 2.5 库存管理模块

#### 2.5.1 蟹卡库存
- 未激活蟹卡数量
- 已激活蟹卡数量
- 已使用蟹卡数量
- 库存预警设置

#### 2.5.2 商品库存
- 商品信息管理（规格、价格）
- 库存数量管理
- 库存预警

### 2.6 统计报表模块

#### 2.6.1 销售统计
- 按时间段统计销售额
- 按商品统计销量
- 销售趋势分析

#### 2.6.2 提货统计
- 提货申请数量统计
- 提货完成率统计
- 提货时效分析

#### 2.6.3 数据导出
- Excel 导出功能
- 报表打印功能

## 三、技术架构

### 3.1 前端技术栈
- **框架**：Vue 3 (Composition API)
- **UI 库**：Element Plus
- **路由**：Vue Router
- **状态管理**：Pinia
- **HTTP 客户端**：Axios
- **构建工具**：Vite
- **代码规范**：ESLint + Prettier

### 3.2 后端技术栈
- **框架**：Node.js + Express 或 Python + FastAPI
- **数据库**：MySQL / PostgreSQL
- **ORM**：Sequelize (Node.js) 或 SQLAlchemy (Python)
- **身份认证**：JWT
- **文件存储**：本地存储或云存储
- **二维码生成**：qrcode 库

### 3.3 数据库设计

#### 3.3.1 核心表结构

**用户表 (users)**
- id: 主键
- username: 用户名
- password: 密码（加密）
- role: 角色（admin/customer）
- phone: 手机号
- email: 邮箱
- created_at: 创建时间
- updated_at: 更新时间

**蟹卡表 (crab_cards)**
- id: 主键
- card_no: 蟹卡编号（唯一）
- qr_code: 二维码数据
- amount: 面额
- status: 状态（inactive/active/used/cancelled）
- user_id: 绑定用户ID（可为空）
- activated_at: 激活时间
- expired_at: 过期时间
- created_at: 创建时间
- updated_at: 更新时间

**商品表 (products)**
- id: 主键
- name: 商品名称
- specification: 规格
- price: 价格
- stock: 库存数量
- description: 描述
- created_at: 创建时间
- updated_at: 更新时间

**订单表 (orders)**
- id: 主键
- order_no: 订单号（唯一）
- user_id: 用户ID
- card_id: 使用的蟹卡ID
- total_amount: 订单总金额
- status: 订单状态（pending/approved/rejected/shipped/completed）
- shipping_address: 收货地址
- shipping_contact: 收货联系人
- shipping_phone: 收货电话
- shipping_method: 配送方式
- tracking_number: 物流单号
- created_at: 创建时间
- updated_at: 更新时间

**订单明细表 (order_items)**
- id: 主键
- order_id: 订单ID
- product_id: 商品ID
- quantity: 数量
- price: 单价
- created_at: 创建时间

**操作日志表 (operation_logs)**
- id: 主键
- user_id: 操作用户ID
- action: 操作类型
- target_type: 目标类型
- target_id: 目标ID
- description: 操作描述
- ip_address: IP地址
- created_at: 创建时间

## 四、项目结构

```
pickup/
├── frontend/                 # 前端项目
│   ├── src/
│   │   ├── api/             # API 接口
│   │   ├── assets/          # 静态资源
│   │   ├── components/      # 公共组件
│   │   ├── router/          # 路由配置
│   │   ├── stores/          # 状态管理
│   │   ├── views/           # 页面组件
│   │   ├── utils/           # 工具函数
│   │   └── App.vue
│   ├── public/
│   ├── package.json
│   └── vite.config.js
│
├── backend/                  # 后端项目
│   ├── src/
│   │   ├── controllers/     # 控制器
│   │   ├── models/          # 数据模型
│   │   ├── routes/          # 路由
│   │   ├── middleware/      # 中间件
│   │   ├── utils/           # 工具函数
│   │   └── app.js
│   ├── config/              # 配置文件
│   ├── migrations/          # 数据库迁移
│   └── package.json
│
├── docs/                    # 项目文档
│   ├── 项目规划.md
│   ├── API文档.md
│   └── 数据库设计.md
│
└── README.md                # 项目说明
```

## 五、开发计划

### 5.1 第一阶段：基础框架搭建
- [ ] 前端项目初始化（Vue 3 + Element Plus）
- [ ] 后端项目初始化（API 框架）
- [ ] 数据库设计和创建
- [ ] 用户认证系统

### 5.2 第二阶段：核心功能开发
- [ ] 蟹卡管理功能
- [ ] 提货管理功能
- [ ] 订单管理功能

### 5.3 第三阶段：扩展功能开发
- [ ] 库存管理功能
- [ ] 统计报表功能
- [ ] 数据导出功能

### 5.4 第四阶段：优化和测试
- [ ] 性能优化
- [ ] 安全加固
- [ ] 测试和 bug 修复
- [ ] 部署上线

## 六、安全考虑

1. **身份认证**：使用 JWT 进行身份验证
2. **密码加密**：使用 bcrypt 加密存储密码
3. **权限控制**：基于角色的访问控制（RBAC）
4. **数据验证**：前后端双重数据验证
5. **SQL 注入防护**：使用 ORM 或参数化查询
6. **XSS 防护**：前端数据转义
7. **CSRF 防护**：使用 CSRF Token

## 七、部署方案

### 7.1 开发环境
- 前端：Vite 开发服务器（端口 5173）
- 后端：Node.js/Python 开发服务器（端口 3000/8000）
- 数据库：本地 MySQL/PostgreSQL

### 7.2 生产环境
- 前端：Nginx 静态文件服务
- 后端：PM2 (Node.js) 或 Gunicorn (Python)
- 数据库：云数据库服务
- 反向代理：Nginx

## 八、后续扩展

1. **移动端支持**：开发移动端 H5 或小程序
2. **短信通知**：提货状态变更短信通知
3. **支付集成**：支持在线支付功能
4. **数据分析**：更丰富的数据分析和可视化
5. **多商户支持**：支持多个商户管理

